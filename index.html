<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Bookmarklets : my bookmarklets" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/custom.css">
    <title>Bookmarklets</title>

    <link  href="http://codemirror.net/lib/codemirror.css" rel="stylesheet" />
    <script src="http://codemirror.net/lib/codemirror.js"></script>
    <script src="http://codemirror.net/mode/javascript/javascript.js"></script>

    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
(function(){
    var BookMarklets = {
            decodeURIComponent: function(){alert(decodeURIComponent(prompt('Enter encoded string for decode:')))},
            encodeURIComponent: function(){alert(encodeURIComponent(prompt('Enter string for encode:')))},
            showHTMLfromJSON:   function(){(function(k){document.body.innerHTML%20=%20JSON.parse(document.body.textContent)[k];})(prompt('Enter%20json-key'))}
        };

    function BookMarklet(source){

        $.ajax({
            type    :'POST',
            dataType:'json',
            url     :'http://closure-compiler.appspot.com/compile',
            data    :{ js_code:'('+source.code+')();',
                       compilation_level:'WHITESPACE_ONLY',
                       output_format:'json',
                       output_info:'compiled_code' },
            success:function(result){
                if(result.compiledCode)
                    $('<div class="bm bookmarklet"/>').append(
                        $('<a/>')
                            .html(source.name)
                            .attr({ href:'javascript:'+encodeURIComponent(result.compiledCode) }),
                        $('<input class="bm source" type="text" />')
                            .val('javascript:'+result.compiledCode)
                            .focus(function(){$(this).select();}),
                        $('<input class="bm source" type="text" />')
                            .val('javascript:'+encodeURIComponent(result.compiledCode))
                            .focus(function(){$(this).select();})
                    ).appendTo($('#main_content'));
            }
        });

    };

    function BookMarkletSubmit(form){
        BookMarklet({ name: $(form).find('.bm.name').val(),
                      code: $(form).find('.bm.editor.code').val() /*.data('editor').getValue()*/ });
        return false;
    }

    google.load("jquery", "1");
    google.setOnLoadCallback(function(){jQuery(function($) {

        $('.bm.form')
            .find('> .bm.submit')
                .click(function(){BookMarkletSubmit(this.form)})
                .end();
//             .find('> .bm.editor.code')
//                .each(function(){ $(this).data({ 'editor':CodeMirror.fromTextArea( this, {lineNumbers:true, mode:'javascript'} )}) })
//                .end();

        for(var i in BookMarklets)
            BookMarklet({name:i, code:BookMarklets[i].toString()});

    });});

})();

    </script>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/sergeymakoveev/bookmarklets">View on GitHub</a>

          <h1 id="project_title">Bookmarklets</h1>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/sergeymakoveev/bookmarklets/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/sergeymakoveev/bookmarklets/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner"></section>
      <hr>
      <div style="text-align:center;">
          <form class='bm form' style="display:inline-block; width: 80%; text-align:left"
                onsubmit="return false;">
            <input    class='bm name' type='text' />
            <div class='bm editor wrapper'>
                <textarea class='bm editor code'></textarea>
                Visual mode: <input    class="bm editor mode" type='checkbox' />
            </div>
            <input    class="bm submit" type='button' value='Make bookmark' />
          </form>
      </div>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Bookmarklets maintained by <a href="https://github.com/sergeymakoveev">sergeymakoveev</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>



  </body>
</html>
